<?xml version="1.0"?>

<project basedir=".." name="generate-build" default="prepare-build">
  <property file="build/local.project.properties"/>
  <property file="build/local.properties"/>
  <property file="build/project.properties"/>
  <property name="allproject.dir" value="${basedir}"/>
  <target name="call-standard-build" description="Do whatever ${project.target} in standard-build asks">
    <ant inheritall="false" dir="${allproject.dir}/build" antfile="standard-build.xml" target="${project.target}">
      <property name="allproject.dir" value="${allproject.dir}"/>
      <property name="build.compiler.emacs" value="true"/>
      <property name="build.log" value="${allproject.dir}/build/targetlogs"/>
      <property name="project.name" value="${ant.project.name}"/>
      <property name="project.work.dir" value="${allproject.dir}/build"/>
      <property name="compile.includeAntRuntime" value="true"/>
      <property name="deploy.product.dir" value="${allproject.dir}/lib"/>
    </ant>
  </target>
  <target name="generate">
    <property name="project-list" value="${allproject.dir}/build/project-list.xml" />
    <property name="stylesheet" value="${allproject.dir}/build/generate-build.xsl" />
    <property name="output" value="${allproject.dir}/build/build.xml" />
    <style
      force="yes"
      style="${stylesheet}"
      in="${project-list}"
      out="${output}">
    </style>
    <echo message="A build file for ${project-list} has been created in ${output}" />
  </target>
  <target name="build-tools" description="build tools jar">
    <antcall target="call-standard-build">
      <param name="project.target" value="deploy"/>
    </antcall>
  </target>
  <target name="clean-tools" description="clean tools jar">
    <antcall target="call-standard-build">
      <param name="project.target" value="clean"/>
    </antcall>
  </target>
  <target name="clean-build-tools" description="clean and build tools jar" depends="clean-tools, build-tools" />
  <target name="prepare-build" description="do all tasks needed for full build" depends="generate, build-tools" />
</project>
